image: archlinux
packages:
  - base-devel
  - devtools
  - git
  - openssh
  - cmake
  - catch2
sources:
  - https://github.com/tarberd/cmake-project-template
tasks:
  - prepare-builder-user: |
      sed --in-place 's/^#\s*\(%wheel\s\+ALL=(ALL)\s\+NOPASSWD:\s\+ALL\)/\1/' /etc/sudoers
      echo "tester ALL=(ALL) NOPASSWD: ALL" >> /etc/sudoer
      useradd -m -G wheel builder
  - build-package: |
      chown -R builder cmake-project-template
      cd cmake-project-template/libhello/package/archlinux
      sudo -u builder ./configure.sh
      cd source-package
      sudo -u builder extra-x86_64-build
